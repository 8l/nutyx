version=1.3.1
source=(
http://golang.org/dl/go${version}.src.tar.gz
go.sh)

build(){
	GARCH=$(`uname -m`)
	export GOOS=linux
	if [ "$GARCH" == 'x86_64' ]; then
		export GOARCH=amd64
	fi
	if [ "$GARCH" == 'i686' ]; then
		export GOARCH=386
	fi

	export GOROOT=$SRC/go
	export GOROOT_FINAL=$PKG/usr/lib/go
	export GOBIN=$GOROOT_FINAL/bin

	mkdir -p $PKG/usr/lib
    cp -Rf $SRC/go $PKG/usr/lib

	cd $GOROOT_FINAL/src
	./make.bash

	# misc
	install -Dm644 $GOROOT_FINAL/misc/bash/go \
		$PKG/usr/share/bash-completion/completions/go
	install -Dm644 $GOROOT_FINAL/misc/emacs/go-mode-load.el \
		$PKG/usr/share/emacs/site-lisp/go-mode-load.el
	install -Dm644 $GOROOT_FINAL/misc/emacs/go-mode.el \
		$PKG/usr/share/emacs/site-lisp/go-mode.el
	install -Dm644 $GOROOT_FINAL/misc/zsh/go \
		$PKG/usr/share/zsh/site-functions/_go

	# vim files
	for f in ftdetect/gofiletype.vim \
		autoload/go/complete.vim \
		indent/go.vim \
		ftplugin/go/fmt.vim \
		ftplugin/go/import.vim \
		syntax/go.vim \
		syntax/godoc.vim \
		plugin/godoc.vim ;
	do
		install -Dm644 $GOROOT_FINAL/misc/vim/$f \
			$PKG/usr/share/vim/vimfiles/$f
	done

	# docs
	mkdir -p $PKG/usr/share/doc/$name-$version
	mv $GOROOT_FINAL/doc/* $PKG/usr/share/doc/$name-$version/
	ln -sf ../../share/doc/$name-$version $PKG/usr/lib/go/doc

	# Remove object files from target src dir
	find $PKG/usr/lib/go/src/ -type f -name '*.[ao]' -delete
	find $PKG/usr/lib/go/src/pkg -type f -executable -delete
	# Fix for FS#32813
	find $PKG -type f -name sql.go -exec chmod -x {} \;

    # go $PATH & uniform $GOPATH for programmers.
	mkdir -p $PKG/usr/lib/go/site
	install -Dm755 $SRC/go.sh $PKG/etc/profile.d/go.sh
}



# NuTyX Pkgfile (http://nutyx.org)
