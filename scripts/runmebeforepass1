echo "Ce script vérifie tout ce qu'il peut pour que vous puissiez commencez"
echo ""
echo "Pressez Entrer pour continuer ou ctrl+c pour interrompre"
echo ""
read a
# Checking the current directory
if [ "`pwd`" != "/home/lfs/saravane" ]; then
	echo "Le script doit être lancé depuis le dossier /home/lfs/saravane"
	exit 1
fi
# Checking the variables
if [ ! -f ~/.bash_profile ]; then
	echo ".bash_profile n'existe pas"
	exit 1
fi
echo ".bash_profile present: OK"
if [ -z "${LFS}" ]; then
	echo "LFS n'existe pas"
	exit 1
fi
echo "LFS: $LFS OK"
if [ -z "${LFS_TGT}" ]; then
   echo "LFS_TGT n'existe pas"
   exit 1
fi
echo "LFS_TGT: $LFS_TGT OK"

# Checking the user

if [ "`whoami`" != "lfs" ]; then 
	echo "Vous n'êtes pas l'utilisateur lfs"
	exit 1
else
	echo "utilisateur lfs: OK"
fi
# Checkings Directories

if [ ! -d $LFS ]; then
	echo "$LFS n'existe pas"
	exit 1
else
	echo "Folder $LFS: OK"
fi
if [ ! -O $LFS ]; then
	echo "$LFS n'appartient pas à lfs"
	exit 1
fi
if [ ! -d $LFS/sources ]; then
   echo "$LFS/sources n'existe pas"
   exit 1
else
	echo "Folder $LFS/sources: OK"
fi
if [ ! -O $LFS/sources ]; then
	echo "$LFS/sources n'appartient pas à lfs"
	exit 1
fi

if [ ! -L /sources ];then
        echo "Faites en root:"
        echo "ln -sv $LFS/sources /sources"
        exit 1
fi
if [ ! -d $LFS/tools ]; then
	echo "$LFS/tools n'existe pas"
	exit 1
else
	echo "Folder $LFS/tools: OK"
fi
if [ ! -O $LFS/tools ];then
	echo "$LFS/tools n'appartient pas à lfs"
	exit 1
fi
if [ ! -d /home/lfs/logs ]; then
   echo "Dossier /home/lfs/logs n'existe pas"
   mkdir -p $HOME/logs
fi
echo "Folder /home/lfs/logs: OK"

# Checking Links

if [ ! -L /tools ]; then
	echo "Lien /tools n'existe pas"
	exit 1
else
	echo "Link /tools: OK"
fi

if [ ! -L /home/lfs/bin ]; then
	echo "Lien /home/lfs/bin n'existe pas"
	ln -sv $HOME/saravane/scripts $HOME/bin
fi
echo "link /home/lfs/bin: OK" 

if [ ! -L /home/lfs/config ];then
   echo "Lien /home/lfs/config n'existe pas"
   ln -sv $HOME/saravane/scripts $HOME/config
fi
echo "link /home/lfs/config: OK"

for i in  wget-list md5sums
do wget http://www.linuxfromscratch.org/lfs/view/stable/$i \
   -O $LFS/sources/$i
   sed -i "/coreutils/d" $LFS/sources/$i
   sed -i "/linux.3.13.3/d" $LFS/sources/$i
   sed -i "/gcc-4.8.2/d" $LFS/sources/$i
   sed -i "/glibc-/d" $LFS/sources/$i
   sed -i "/shadow-/d" $LFS/sources/$i
   sed -i "/shadow_/d" $LFS/sources/$i
   sed -i "/gettext-/d" $LFS/sources/$i
   sed -i "/util-linux-/d" $LFS/sources/$i
   sed -i "/gawk-/d" $LFS/sources/$i
   sed -i "/gmp-/d" $LFS/sources/$i
   sed -i "/man-db-/d" $LFS/sources/$i
   sed -i "/tzdata/d" $LFS/sources/$i
   sed -i "/kbd-/d" $LFS/sources/$i
   sed -i "/perl-/d" $LFS/sources/$i
   sed -i "/file-/d" $LFS/sources/$i
   sed -i "/e2fsprogs-/d" $LFS/sources/$i
   sed -i "/grep-/d" $LFS/sources/$i
   sed -i "/lfs-bootscripts-/d" $LFS/sources/$i
   sed -i "/check-/d" $LFS/sources/$i
   sed -i "/libpipeline-/d" $LFS/sources/$i
   sed -i "/tcl/d" $LFS/sources/$i
   sed -i "/tar-/d" $LFS/sources/$i
done
echo "60d96aa6e111c4cf06a8a2186c60a281  eudev-1.10.tar.gz
8103eaf6d71acb716a64224492f09d5f  tcl8.6.2-src.tar.gz
6c823b40fdcfa7b8120743349a52ac18  iproute2-3.16.0.tar.xz
1e6a827f5fbd98b3d40bd16b803acc44  gettext-0.19.2.tar.xz
abed135279f87ad6762ce57ff6d89c41  coreutils-8.23.tar.xz
e3526f59023f3f7d1ffa4d541335edab  file-5.19.tar.gz
82835c7f01983634e06ca72b4ee30cc6  kmod-18.tar.xz
2cbea44a4f1548aee20b9ff2d3076908  grep-2.20.tar.xz
38263d115d784c17aa3b959ce94be8b8  check-0.9.14.tar.gz
5be15528788635818104146957171f5d  eudev-1.10-manpages.tar.bz2
c2d6b127f89261513b23b6d458484099  udev-lfs-20140408.tar.bz2
ede5166f949d9a07163bc5b086be9759  perl-5.20.1.tar.bz2
68255f51be017a93f2f6402fab06c2bf  e2fsprogs-1.42.12.tar.gz
ed05111948beba8a0f30956baa46b272  tzdata2014h.tar.gz
97ae0ecd007750f776099fcb9fccc7af  nasm-2.11.04.tar.xz
fddf71348546af523353bd43d34919c1  gcc-4.9.1.tar.bz2
948a6e06419a01bd51e97206861595b0  glibc-2.20.tar.xz
49b6306167724fe48f419a33a5beb857  tar-1.28.tar.xz
48e4e96a60bfed41804aaecf4944f5d9  binutils-2.24-load_gcc_lto_plugin_by_default-1.patch
d43ab9f680435a7fff35b4ace8d45b80  libcap-2.24.tar.xz
ba56fb5bfd44acea83fc5dac4a9b7f15  kbd-2.0.2.tar.gz
f75cca16a38da6caa7d52151f7136895  kbd-2.0.2-backspace-1.patch
a2a26543ce410eb74bc4a508349ed09a  gawk-4.1.1.tar.xz
1e6da4e434553d2811437aa42c7f7c76  gmp-6.0.0a.tar.xz
a4650aebcc464bb91113c2c356da8210  XML-Parser-2.42_01.tar.gz
23fbd879118253cb99aeac067da5f591  intltool-0.50.2.tar.gz
2ff36a8f8ede70f66c5ad0fb09e40e79  util-linux-2.25.1.tar.xz
2bfafe7d4962682d31b5eba65dba4fc8  shadow-4.2.1.tar.xz
227814a1a523992400da5d5437552445  linux-3.16.2.tar.xz
fe2962824587070a2ec53f77e40b0fea  r8168-8.038.00.tar.bz2
ce7b697f8e8016a085d9f5975ae6c4fb  man-db-2.6.7.1.tar.xz
dd7dab7a5fea97d2a6a43f511449b7cd  expat-2.1.0.tar.gz
c1f1db32fb6598d6a93e6e88796a8632  gperf-3.0.4.tar.gz
c8dc151a671b9b92ff3e4c118b174972  openssl-1.0.1i.tar.gz
efad5a503f66329bb9d2f4308b5de98a  libarchive-3.1.2.tar.gz
de9f1f45026c2f4e0776058d429ff4b6  xfsprogs-3.1.11.tar.gz
9deabf6ed618c12794259b9cf35febd3  nutyx-basicfs-20141004.tar.bz2
3e06f3d64768cb95a65e71a17f14d52e  ca-certificates-20141001.tar.gz
95c627abcf6494f5abe55effe7cd6a57  curl-7.37.1.tar.bz2
d92ab59aabf5173f2a59089531e30dbf  squashfs4.3.tar.gz
fcd8d0d9f9f0397d076ee901e242ed39  sudo-1.8.10p3.tar.gz
fe7806d075994db0e28894e42668a02a  pciutils-3.2.1.tar.xz
e712190d0cf159fb942dcf5e99376641  cards-0.10.81.3.tar.gz" >> $LFS/sources/md5sums

for i in `cat $LFS/sources/wget-list`
do
   if [ ! -f $LFS/sources/`basename $i` ]; then
      wget --no-check-certificate $i -P $LFS/sources
   fi
done

for i in `cat scripts/wget_nutyx_list`
do 
	if [ ! -f $LFS/sources/`basename $i` ]; then 
		wget --no-check-certificate $i -P $LFS/sources
	fi
done
if [ -f $LFS/sources/md5sums ]; then
	pushd  $LFS/sources
	md5sum -c md5sums || exit 1
	popd
else
	echo "$LFS/sources/md5sums pas trouvé, impossible de vérifier les sources"
	exit 1
fi
echo ""
echo "====> Successfull configured"
echo ""
echo "Si vous lisez ce message, faites:"
echo ""
echo "cd $HOME/saravane/chroot"
echo "pass"
echo ""
echo "Admirez le travail ..."
echo "" 
